<!--
====================================================================
DASHBOARD FRAMEWORK - ARCHIVO CONSOLIDADO
====================================================================
Generado automáticamente: sábado,  9 de agosto de 2025, 07:59:00 CST
Archivos integrados:
  - base.css
  - components.css
  - layout.css
  - responsive.css
  - config.js
  - dashboard.js
  - charts.js
  - utils.js

CONFIGURACIÓN PENDIENTE:
1. Buscar 'https://irhcudgyudmwwoamtwoo.supabase.co' y reemplazar con tu URL de Supabase
2. Buscar 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlyaGN1ZGd5dWRtd3dvYW10d29vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2ODQyMjksImV4cCI6MjA2NzI2MDIyOX0.kDQRr5H3jsBabERN2blVRAiGOaU4E2TnikYp19wOv28' y reemplazar con tu clave anónima

Autor: Dashboard Framework Generator
====================================================================
-->

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Framework Agentes Multicapa</title>
    
    <!-- CSS Modular -->
    
    
    
    
    
    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Custom Styles -->
    

    <!-- Estilos Consolidados -->
    <style>
        /* ===== BASE STYLES - Variables, Global Styles, Containers ===== */

:root {
    /* Color Palette - Blue, Cyan, Turquoise with Black details */
    --primary-blue: #1e40af;
    --primary-cyan: #06b6d4;
    --primary-turquoise: #14b8a6;
    --accent-white: #ffffff;
    --accent-black: #1f2937;
    --bg-primary: #f8fafc;
    --bg-secondary: #f1f5f9;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --border-color: #e2e8f0;
    
    /* Shadows */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    
    /* Animation */
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    --bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
    
    /* Spacing */
    --space-xs: 0.25rem;
    --space-sm: 0.5rem;
    --space-md: 1rem;
    --space-lg: 1.5rem;
    --space-xl: 2rem;
    --space-2xl: 3rem;
    
    /* Border Radius */
    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    --radius-2xl: 1.5rem;
    
    /* Typography */
    --font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    --font-mono: 'Fira Code', 'Monaco', 'Courier New', monospace;
    
    /* Z-Index Scale */
    --z-dropdown: 1000;
    --z-sticky: 1020;
    --z-fixed: 1030;
    --z-modal-backdrop: 1040;
    --z-modal: 1050;
    --z-popover: 1060;
    --z-tooltip: 1070;
    --z-toast: 9999;
}

/* ===== GLOBAL RESET & BASE STYLES ===== */
*,
*::before,
*::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html {
    scroll-behavior: smooth;
    font-size: 16px;
}

body {
    font-family: var(--font-family);
    line-height: 1.6;
    color: var(--text-primary);
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #ffffff 100%);
    background-attachment: fixed;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* ===== CONTAINER SYSTEM ===== */
.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 var(--space-lg);
    width: 100%;
}

.container-fluid {
    width: 100%;
    padding: 0 var(--space-lg);
}

.container-sm {
    max-width: 640px;
    margin: 0 auto;
    padding: 0 var(--space-lg);
}

.container-md {
    max-width: 768px;
    margin: 0 auto;
    padding: 0 var(--space-lg);
}

.container-lg {
    max-width: 1024px;
    margin: 0 auto;
    padding: 0 var(--space-lg);
}

.container-xl {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 var(--space-lg);
}

/* ===== TYPOGRAPHY BASE ===== */
h1, h2, h3, h4, h5, h6 {
    font-weight: 600;
    line-height: 1.2;
    color: var(--text-primary);
    margin-bottom: var(--space-md);
}

h1 { font-size: 2.25rem; }
h2 { font-size: 1.875rem; }
h3 { font-size: 1.5rem; }
h4 { font-size: 1.25rem; }
h5 { font-size: 1.125rem; }
h6 { font-size: 1rem; }

p {
    margin-bottom: var(--space-md);
    color: var(--text-secondary);
}

a {
    color: var(--primary-cyan);
    text-decoration: none;
    transition: var(--transition-fast);
}

a:hover {
    color: var(--primary-turquoise);
    text-decoration: underline;
}

/* ===== UTILITY CLASSES ===== */
.text-center { text-align: center; }
.text-left { text-align: left; }
.text-right { text-align: right; }

.font-mono { font-family: var(--font-mono); }
.font-sans { font-family: var(--font-family); }

.text-xs { font-size: 0.75rem; }
.text-sm { font-size: 0.875rem; }
.text-base { font-size: 1rem; }
.text-lg { font-size: 1.125rem; }
.text-xl { font-size: 1.25rem; }
.text-2xl { font-size: 1.5rem; }
.text-3xl { font-size: 1.875rem; }

.font-light { font-weight: 300; }
.font-normal { font-weight: 400; }
.font-medium { font-weight: 500; }
.font-semibold { font-weight: 600; }
.font-bold { font-weight: 700; }

.text-primary { color: var(--text-primary); }
.text-secondary { color: var(--text-secondary); }
.text-white { color: white; }

.bg-primary { background-color: var(--bg-primary); }
.bg-secondary { background-color: var(--bg-secondary); }
.bg-white { background-color: white; }

/* ===== SPACING UTILITIES ===== */
.m-0 { margin: 0; }
.m-1 { margin: var(--space-xs); }
.m-2 { margin: var(--space-sm); }
.m-3 { margin: var(--space-md); }
.m-4 { margin: var(--space-lg); }
.m-5 { margin: var(--space-xl); }

.p-0 { padding: 0; }
.p-1 { padding: var(--space-xs); }
.p-2 { padding: var(--space-sm); }
.p-3 { padding: var(--space-md); }
.p-4 { padding: var(--space-lg); }
.p-5 { padding: var(--space-xl); }

.mt-0 { margin-top: 0; }
.mt-1 { margin-top: var(--space-xs); }
.mt-2 { margin-top: var(--space-sm); }
.mt-3 { margin-top: var(--space-md); }
.mt-4 { margin-top: var(--space-lg); }
.mt-5 { margin-top: var(--space-xl); }

.mb-0 { margin-bottom: 0; }
.mb-1 { margin-bottom: var(--space-xs); }
.mb-2 { margin-bottom: var(--space-sm); }
.mb-3 { margin-bottom: var(--space-md); }
.mb-4 { margin-bottom: var(--space-lg); }
.mb-5 { margin-bottom: var(--space-xl); }

/* ===== DISPLAY UTILITIES ===== */
.hidden { display: none; }
.block { display: block; }
.inline { display: inline; }
.inline-block { display: inline-block; }
.flex { display: flex; }
.inline-flex { display: inline-flex; }
.grid { display: grid; }

.flex-col { flex-direction: column; }
.flex-row { flex-direction: row; }
.flex-wrap { flex-wrap: wrap; }
.flex-nowrap { flex-wrap: nowrap; }

.items-start { align-items: flex-start; }
.items-center { align-items: center; }
.items-end { align-items: flex-end; }
.items-stretch { align-items: stretch; }

.justify-start { justify-content: flex-start; }
.justify-center { justify-content: center; }
.justify-end { justify-content: flex-end; }
.justify-between { justify-content: space-between; }
.justify-around { justify-content: space-around; }

.flex-1 { flex: 1; }
.flex-auto { flex: auto; }
.flex-none { flex: none; }

/* ===== BORDER UTILITIES ===== */
.border { border: 1px solid var(--border-color); }
.border-t { border-top: 1px solid var(--border-color); }
.border-b { border-bottom: 1px solid var(--border-color); }
.border-l { border-left: 1px solid var(--border-color); }
.border-r { border-right: 1px solid var(--border-color); }

.rounded { border-radius: var(--radius-md); }
.rounded-sm { border-radius: var(--radius-sm); }
.rounded-lg { border-radius: var(--radius-lg); }
.rounded-xl { border-radius: var(--radius-xl); }
.rounded-2xl { border-radius: var(--radius-2xl); }
.rounded-full { border-radius: 9999px; }

/* ===== SHADOW UTILITIES ===== */
.shadow-sm { box-shadow: var(--shadow-sm); }
.shadow { box-shadow: var(--shadow-md); }
.shadow-md { box-shadow: var(--shadow-md); }
.shadow-lg { box-shadow: var(--shadow-lg); }
.shadow-xl { box-shadow: var(--shadow-xl); }
.shadow-none { box-shadow: none; }

/* ===== TRANSITION UTILITIES ===== */
.transition { transition: var(--transition); }
.transition-fast { transition: var(--transition-fast); }
.transition-none { transition: none; }

/* ===== POSITION UTILITIES ===== */
.relative { position: relative; }
.absolute { position: absolute; }
.fixed { position: fixed; }
.sticky { position: sticky; }

.top-0 { top: 0; }
.right-0 { right: 0; }
.bottom-0 { bottom: 0; }
.left-0 { left: 0; }

/* ===== OVERFLOW UTILITIES ===== */
.overflow-hidden { overflow: hidden; }
.overflow-auto { overflow: auto; }
.overflow-scroll { overflow: scroll; }
.overflow-x-hidden { overflow-x: hidden; }
.overflow-y-hidden { overflow-y: hidden; }
.overflow-x-auto { overflow-x: auto; }
.overflow-y-auto { overflow-y: auto; }

/* ===== CURSOR UTILITIES ===== */
.cursor-pointer { cursor: pointer; }
.cursor-default { cursor: default; }
.cursor-not-allowed { cursor: not-allowed; }

/* ===== SELECTION STYLES ===== */
::selection {
    background: var(--primary-cyan);
    color: white;
}

::-moz-selection {
    background: var(--primary-cyan);
    color: white;
}

/* ===== SCROLLBAR STYLES ===== */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--bg-secondary);
    border-radius: var(--radius-sm);
}

::-webkit-scrollbar-thumb {
    background: var(--border-color);
    border-radius: var(--radius-sm);
    transition: var(--transition);
}

::-webkit-scrollbar-thumb:hover {
    background: var(--text-secondary);
}

/* ===== FOCUS STYLES ===== */
*:focus {
    outline: 2px solid var(--primary-cyan);
    outline-offset: 2px;
}

*:focus:not(:focus-visible) {
    outline: none;
}

*:focus-visible {
    outline: 2px solid var(--primary-cyan);
    outline-offset: 2px;
}

/* ===== DARK MODE BASE ===== */
@media (prefers-color-scheme: dark) {
    :root {
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
        --text-primary: #f1f5f9;
        --text-secondary: #94a3b8;
        --border-color: #334155;
    }
    
    body {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
    }
}

/* ===== COMPONENTS - Header, Buttons, Forms, Controls ===== */

/* ===== HEADER STYLES ===== */
.glass-header {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-cyan) 100%);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: var(--shadow-xl);
    position: sticky;
    top: 0;
    z-index: var(--z-sticky);
}

.icon-container {
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-2xl);
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: var(--transition);
}

.icon-container:hover {
    transform: scale(1.05);
    background: rgba(255, 255, 255, 0.3);
}

.control-panel {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    flex-wrap: wrap;
}

.control-select {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-md);
    padding: var(--space-sm) var(--space-md);
    color: white;
    font-size: 0.875rem;
    backdrop-filter: blur(10px);
    transition: var(--transition);
    min-width: 120px;
}

.control-select:focus {
    outline: none;
    border-color: rgba(255, 255, 255, 0.5);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.15);
}

.control-select.small {
    padding: 0.375rem 0.75rem;
    font-size: 0.75rem;
    min-width: 100px;
}

.button-group {
    display: flex;
    align-items: center;
    gap: var(--space-md);
    flex-wrap: wrap;
}

.timestamp-display {
    text-align: right;
    padding: var(--space-sm);
    background: rgba(255, 255, 255, 0.1);
    border-radius: var(--radius-md);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* ===== BUTTON SYSTEM ===== */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-sm);
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius-xl);
    font-weight: 600;
    font-size: 0.875rem;
    text-decoration: none;
    cursor: pointer;
    transition: var(--transition);
    border: none;
    position: relative;
    overflow: hidden;
    white-space: nowrap;
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-cyan) 0%, var(--primary-turquoise) 100%);
    color: white;
    box-shadow: var(--shadow-md);
}

.btn-primary:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, var(--primary-turquoise) 0%, var(--primary-cyan) 100%);
}

.btn-primary:active {
    transform: translateY(0);
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
}

.btn-secondary:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
}

.btn-success {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
    box-shadow: var(--shadow-md);
}

.btn-success:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, #059669 0%, #047857 100%);
}

.btn-warning {
    background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
    color: white;
    box-shadow: var(--shadow-md);
}

.btn-warning:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
}

.btn-info {
    background: linear-gradient(135deg, var(--primary-blue) 0%, #3b82f6 100%);
    color: white;
    box-shadow: var(--shadow-md);
}

.btn-info:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
}

.btn-danger {
    background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
    color: white;
    box-shadow: var(--shadow-md);
}

.btn-danger:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
    background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
}

.btn-ghost {
    background: transparent;
    color: var(--text-primary);
    border: 1px solid var(--border-color);
}

.btn-ghost:hover:not(:disabled) {
    background: var(--bg-secondary);
    border-color: var(--primary-cyan);
    color: var(--primary-cyan);
}

.btn-icon {
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: var(--space-sm);
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
}

.btn-icon:hover {
    background: white;
    color: var(--primary-cyan);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.75rem;
}

.btn-lg {
    padding: 1rem 2rem;
    font-size: 1rem;
}

.btn-full {
    width: 100%;
}

/* ===== TOGGLE SWITCH ===== */
.toggle-switch {
    position: relative;
    width: 48px;
    height: 24px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 24px;
    cursor: pointer;
    appearance: none;
    outline: none;
    transition: var(--transition);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.toggle-switch:checked {
    background: var(--primary-cyan);
    border-color: var(--primary-cyan);
}

.toggle-switch::before {
    content: '';
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: white;
    top: 2px;
    left: 2px;
    transition: var(--transition);
    box-shadow: var(--shadow-sm);
}

.toggle-switch:checked::before {
    transform: translateX(24px);
}

.toggle-switch:focus {
    box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.2);
}

/* ===== FORM ELEMENTS ===== */
.form-group {
    margin-bottom: var(--space-md);
}

.form-label {
    display: block;
    font-weight: 500;
    margin-bottom: var(--space-sm);
    color: var(--text-primary);
    font-size: 0.875rem;
}

.form-input,
.form-select,
.form-textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    background: white;
    color: var(--text-primary);
    font-size: 0.875rem;
    transition: var(--transition);
    font-family: inherit;
}

.form-input:focus,
.form-select:focus,
.form-textarea:focus {
    outline: none;
    border-color: var(--primary-cyan);
    box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
}

.form-input:disabled,
.form-select:disabled,
.form-textarea:disabled {
    background: var(--bg-secondary);
    color: var(--text-secondary);
    cursor: not-allowed;
}

.form-textarea {
    resize: vertical;
    min-height: 100px;
}

.form-error {
    color: #ef4444;
    font-size: 0.75rem;
    margin-top: var(--space-xs);
}

.form-help {
    color: var(--text-secondary);
    font-size: 0.75rem;
    margin-top: var(--space-xs);
}

/* ===== INPUT GROUPS ===== */
.input-group {
    display: flex;
    align-items: stretch;
}

.input-group .form-input {
    border-radius: 0;
    border-right: none;
}

.input-group .form-input:first-child {
    border-top-left-radius: var(--radius-md);
    border-bottom-left-radius: var(--radius-md);
}

.input-group .form-input:last-child {
    border-top-right-radius: var(--radius-md);
    border-bottom-right-radius: var(--radius-md);
    border-right: 1px solid var(--border-color);
}

.input-group-prepend,
.input-group-append {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.input-group-prepend {
    border-right: none;
    border-top-left-radius: var(--radius-md);
    border-bottom-left-radius: var(--radius-md);
}

.input-group-append {
    border-left: none;
    border-top-right-radius: var(--radius-md);
    border-bottom-right-radius: var(--radius-md);
}

/* ===== SEARCH COMPONENTS ===== */
.search-input-group {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
}

.search-input {
    width: 100%;
    padding: var(--space-md);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    font-size: 1rem;
    background: white;
    transition: var(--transition);
    padding-left: 3rem;
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-cyan);
    box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
}

.search-input::placeholder {
    color: var(--text-secondary);
}

.search-icon {
    position: absolute;
    left: var(--space-md);
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    pointer-events: none;
}

.search-filters {
    display: flex;
    gap: var(--space-md);
    align-items: center;
    flex-wrap: wrap;
}

/* ===== BADGE SYSTEM ===== */
.badge {
    display: inline-flex;
    align-items: center;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.025em;
}

.badge-primary {
    background: var(--primary-cyan);
    color: white;
}

.badge-secondary {
    background: var(--bg-secondary);
    color: var(--text-secondary);
}

.badge-success {
    background: #10b981;
    color: white;
}

.badge-warning {
    background: #f59e0b;
    color: white;
}

.badge-danger {
    background: #ef4444;
    color: white;
}

.badge-info {
    background: var(--primary-blue);
    color: white;
}

/* ===== STATUS INDICATORS ===== */
.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
    margin-right: var(--space-sm);
}

.status-indicator.active {
    background: #10b981;
    animation: pulse 2s infinite;
}

.status-indicator.warning {
    background: #f59e0b;
}

.status-indicator.error {
    background: #ef4444;
}

.status-indicator.inactive {
    background: #6b7280;
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
}

.status-dot.active {
    background: #10b981;
}

.status-dot.warning {
    background: #f59e0b;
}

.status-dot.error {
    background: #ef4444;
}

.status-dot.inactive {
    background: #6b7280;
}

/* ===== LOADING STATES ===== */
.spinner {
    width: 20px;
    height: 20px;
    border: 2px solid transparent;
    border-top: 2px solid currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

.loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: var(--z-modal);
}

/* ===== ANIMATIONS ===== */
@keyframes pulse {
    0%, 100% {
        opacity: 1;
    }
    50% {
        opacity: 0.5;
    }
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ===== COMPONENT STATES ===== */
.is-loading {
    position: relative;
    pointer-events: none;
}

.is-loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: var(--z-modal);
}

.is-disabled {
    opacity: 0.6;
    pointer-events: none;
    cursor: not-allowed;
}

.is-active {
    background: var(--primary-cyan);
    color: white;
}

.is-selected {
    background: var(--bg-secondary);
    border-color: var(--primary-cyan);
}

/* ===== NOTIFICATION SYSTEM ===== */
.notification-container {
    position: fixed;
    top: var(--space-md);
    right: var(--space-md);
    z-index: var(--z-toast);
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    max-width: 400px;
    pointer-events: none;
}

.notification {
    background: white;
    border-radius: var(--radius-xl);
    padding: var(--space-md);
    box-shadow: var(--shadow-xl);
    border: 1px solid var(--border-color);
    border-left: 4px solid var(--primary-cyan);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    animation: slideInRight 0.3s var(--bounce);
    pointer-events: auto;
    position: relative;
}

.notification.success {
    border-left-color: #10b981;
}

.notification.warning {
    border-left-color: #f59e0b;
}

.notification.error {
    border-left-color: #ef4444;
}

.notification.info {
    border-left-color: var(--primary-blue);
}

.notification-icon {
    font-size: 1.25rem;
    color: var(--primary-cyan);
    flex-shrink: 0;
}

.notification.success .notification-icon {
    color: #10b981;
}

.notification.warning .notification-icon {
    color: #f59e0b;
}

.notification.error .notification-icon {
    color: #ef4444;
}

.notification.info .notification-icon {
    color: var(--primary-blue);
}

.notification-content {
    flex: 1;
}

.notification-title {
    font-weight: 600;
    color: var(--text-primary);
    margin: 0 0 0.25rem 0;
    font-size: 0.875rem;
}

.notification-message {
    color: var(--text-secondary);
    font-size: 0.875rem;
    margin: 0;
    line-height: 1.4;
}

.notification-close {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.25rem;
    border-radius: var(--radius-sm);
    transition: var(--transition);
    flex-shrink: 0;
}

.notification-close:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
/* ===== LAYOUT - Grids, Panels, Cards, Sections ===== */

/* ===== GRID SYSTEMS ===== */
.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.activity-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: var(--space-lg);
    margin-bottom: var(--space-xl);
}

.domain-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--space-md);
    padding: var(--space-lg);
}

.control-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-lg);
    padding: var(--space-lg);
}

/* ===== METRIC CARDS ===== */
.metric-card {
    background: white;
    border-radius: var(--radius-2xl);
    padding: var(--space-lg);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    animation: fadeIn 0.6s ease-out;
}

.metric-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary-cyan) 0%, var(--primary-turquoise) 100%);
}

.metric-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-xl);
}

.metric-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--space-md);
}

.metric-label {
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 500;
    margin: 0 0 var(--space-sm) 0;
}

.metric-value {
    color: var(--text-primary);
    font-size: 2.5rem;
    font-weight: 700;
    margin: 0;
    line-height: 1;
    font-variant-numeric: tabular-nums;
}

.metric-icon {
    width: 64px;
    height: 64px;
    border-radius: var(--radius-2xl);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    box-shadow: var(--shadow-md);
    background: linear-gradient(135deg, var(--primary-cyan) 0%, var(--primary-turquoise) 100%);
}

.metric-trend {
    margin-top: var(--space-md);
    padding-top: var(--space-md);
    border-top: 1px solid var(--border-color);
}

.trend-positive {
    color: #10b981;
    font-size: 0.875rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.trend-negative {
    color: #ef4444;
    font-size: 0.875rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.trend-neutral {
    color: var(--text-secondary);
    font-size: 0.875rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

/* ===== CHART CONTAINERS ===== */
.chart-container {
    background: white;
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    overflow: hidden;
    animation: fadeIn 0.8s ease-out;
}

.chart-header {
    padding: var(--space-lg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
}

.chart-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.chart-controls {
    display: flex;
    gap: var(--space-sm);
}

.chart-btn {
    padding: var(--space-sm) var(--space-md);
    border: 1px solid var(--border-color);
    background: white;
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-secondary);
    font-weight: 500;
}

.chart-btn:hover,
.chart-btn.active {
    background: var(--primary-cyan);
    color: white;
    border-color: var(--primary-cyan);
    transform: translateY(-1px);
}

.chart-content {
    padding: var(--space-lg);
    height: 300px;
    position: relative;
}

.chart-legend {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-md);
    margin-top: var(--space-sm);
    padding-top: var(--space-sm);
    border-top: 1px solid var(--border-color);
}

.legend-item {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    font-size: 0.875rem;
    color: var(--text-secondary);
}

.legend-color {
    width: 12px;
    height: 12px;
    border-radius: 2px;
    flex-shrink: 0;
}

/* ===== CONTENT PANELS ===== */
.content-panel {
    background: white;
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    overflow: hidden;
    animation: fadeIn 1s ease-out;
}

.panel-header {
    padding: var(--space-lg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
}

.panel-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.panel-content {
    padding: var(--space-lg);
    max-height: 400px;
    overflow-y: auto;
}

.items-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
}

/* ===== DOMAIN SECTION ===== */
.domain-section {
    background: white;
    border-radius: var(--radius-2xl);
    box-shadow: var(--shadow-lg);
    border: 1px solid var(--border-color);
    overflow: hidden;
    animation: fadeIn 1.2s ease-out;
}

.section-header {
    padding: var(--space-lg);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
}

.section-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.section-controls {
    display: flex;
    gap: var(--space-sm);
}

.control-btn {
    padding: var(--space-sm) var(--space-md);
    border: 1px solid var(--border-color);
    background: white;
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    cursor: pointer;
    transition: var(--transition);
    color: var(--text-secondary);
    font-weight: 500;
}

.control-btn:hover,
.control-btn.active {
    background: var(--primary-turquoise);
    color: white;
    border-color: var(--primary-turquoise);
    transform: translateY(-1px);
}

.domain-card {
    background: var(--bg-secondary);
    border-radius: var(--radius-xl);
    padding: var(--space-lg);
    text-align: center;
    border: 1px solid var(--border-color);
    transition: var(--transition);
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.domain-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary-cyan) 0%, var(--primary-turquoise) 100%);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.domain-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    background: white;
}

.domain-card:hover::before {
    transform: scaleX(1);
}

.domain-name {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--space-md);
    font-size: 1rem;
}

.domain-stats {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.875rem;
}

.stat-label {
    color: var(--text-secondary);
}

.stat-value {
    font-weight: 600;
    color: var(--primary-cyan);
    font-variant-numeric: tabular-nums;
}

/* ===== LAYOUT ANIMATIONS ===== */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ===== LAYOUT UTILITIES ===== */
.layout-wrapper {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
}

.main-content {
    flex: 1;
    padding: var(--space-lg) 0;
}

.section-spacing {
    margin-bottom: var(--space-xl);
}

.card-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-lg);
}

.divider {
    height: 1px;
    background: var(--border-color);
    margin: var(--space-xl) 0;
}

.divider-vertical {
    width: 1px;
    background: var(--border-color);
    margin: 0 var(--space-lg);
}

/* ===== RESPONSIVE - Media Queries, Animations, Accessibility ===== */

/* ===== RESPONSIVE BREAKPOINTS ===== */
@media (max-width: 1200px) {
    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .activity-grid {
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }
    
    .metrics-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    }
}

@media (max-width: 768px) {
    .container {
        padding: 0 var(--space-md);
    }
    
    .glass-header .container {
        padding: 0 var(--space-md);
    }
    
    .control-panel {
        flex-wrap: wrap;
        gap: var(--space-sm);
    }
    
    .button-group {
        flex-wrap: wrap;
        gap: var(--space-sm);
    }
    
    .metrics-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: var(--space-md);
    }
    
    .content-grid {
        grid-template-columns: 1fr;
        gap: var(--space-md);
    }
    
    .domain-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    }
    
    .activity-grid {
        grid-template-columns: 1fr;
        gap: var(--space-md);
    }
    
    .control-grid {
        grid-template-columns: 1fr;
        gap: var(--space-md);
    }
    
    .search-filters {
        flex-direction: column;
        align-items: stretch;
        gap: var(--space-sm);
    }
    
    .chart-header {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-md);
    }
    
    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-md);
    }
    
    .panel-header {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-sm);
    }
    
    .notification-container {
        top: var(--space-sm);
        right: var(--space-sm);
        left: var(--space-sm);
        max-width: none;
    }
    
    .footer-content {
        flex-direction: column;
        text-align: center;
    }
}

@media (max-width: 480px) {
    .container {
        padding: 0 var(--space-sm);
    }
    
    .metrics-grid {
        grid-template-columns: 1fr;
    }
    
    .metric-card {
        padding: var(--space-md);
    }
    
    .metric-value {
        font-size: 2rem;
    }
    
    .metric-icon {
        width: 48px;
        height: 48px;
        font-size: 1.25rem;
    }
    
    .chart-content {
        height: 250px;
        padding: var(--space-md);
    }
    
    .panel-content {
        padding: var(--space-md);
        max-height: 300px;
    }
    
    .logs-list {
        font-size: 0.75rem;
    }
    
    .log-entry {
        font-size: 0.7rem;
        gap: var(--space-sm);
    }
    
    .control-panel {
        gap: var(--space-xs);
    }
    
    .button-group {
        gap: var(--space-xs);
    }
    
    .btn {
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
    }
    
    .glass-header {
        padding: var(--space-sm) 0;
    }
    
    .icon-container {
        width: 48px;
        height: 48px;
    }
    
    .timestamp-display {
        font-size: 0.75rem;
    }
    
    .domain-grid {
        grid-template-columns: 1fr;
    }
    
    .real-time-list,
    .top-agents-list,
    .alerts-list {
        max-height: 250px;
    }
}

/* ===== LANDSCAPE ORIENTATION ===== */
@media (max-height: 500px) and (orientation: landscape) {
    .glass-header {
        position: static;
    }
    
    .chart-content {
        height: 200px;
    }
    
    .panel-content {
        max-height: 200px;
    }
    
    .logs-list {
        max-height: 200px;
    }
    
    .real-time-list,
    .top-agents-list,
    .alerts-list {
        max-height: 200px;
    }
}

/* ===== PRINT STYLES ===== */
@media print {
    .glass-header,
    .footer,
    .notification-container,
    .btn-primary,
    .btn-secondary,
    .btn-success,
    .btn-warning,
    .btn-info,
    .btn-icon,
    .control-panel,
    .button-group,
    .chart-controls,
    .section-controls {
        display: none !important;
    }
    
    body {
        background: white !important;
        color: black !important;
        font-size: 12pt;
        line-height: 1.4;
    }
    
    .metric-card,
    .chart-container,
    .content-panel,
    .domain-section,
    .activity-panel,
    .logs-section,
    .search-section,
    .control-section {
        background: white !important;
        box-shadow: none !important;
        border: 1px solid #ccc !important;
        page-break-inside: avoid;
        margin-bottom: 1rem !important;
    }
    
    .charts-grid,
    .content-grid,
    .activity-grid {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
    }
    
    .metrics-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 1rem !important;
    }
    
    .chart-content {
        height: auto !important;
        min-height: 200px;
    }
    
    .metric-value {
        font-size: 1.5rem !important;
    }
    
    .panel-content,
    .logs-list {
        max-height: none !important;
        overflow: visible !important;
    }
    
    .domain-grid {
        grid-template-columns: repeat(3, 1fr) !important;
    }
    
    .log-entry {
        page-break-inside: avoid;
    }
    
    h1, h2, h3, h4, h5, h6 {
        page-break-after: avoid;
    }
    
    .metric-card::before,
    .domain-card::before {
        display: none !important;
    }
}

/* ===== DARK MODE ===== */
@media (prefers-color-scheme: dark) {
    .metric-card,
    .chart-container,
    .content-panel,
    .domain-section,
    .activity-panel,
    .logs-section,
    .search-section,
    .control-section {
        background: rgba(30, 41, 59, 0.8) !important;
        backdrop-filter: blur(10px);
        border-color: var(--border-color);
    }
    
    .domain-card,
    .control-card {
        background: rgba(15, 23, 42, 0.8) !important;
    }
    
    .domain-card:hover {
        background: rgba(30, 41, 59, 0.9) !important;
    }
    
    .form-input,
    .form-select,
    .form-textarea,
    .search-input,
    .chart-btn,
    .control-btn {
        background: rgba(15, 23, 42, 0.8) !important;
        border-color: var(--border-color);
        color: var(--text-primary);
    }
    
    .notification {
        background: rgba(30, 41, 59, 0.95) !important;
        backdrop-filter: blur(20px);
    }
    
    .chart-header,
    .panel-header,
    .section-header,
    .search-form {
        background: rgba(15, 23, 42, 0.6) !important;
    }
    
    .real-time-item,
    .alert-item {
        background: rgba(15, 23, 42, 0.8) !important;
    }
    
    .real-time-item:hover,
    .alert-item:hover {
        background: rgba(30, 41, 59, 0.9) !important;
    }
}

/* ===== REDUCED MOTION ===== */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
    
    .status-indicator,
    .status-dot {
        animation: none !important;
    }
    
    .metric-card,
    .chart-container,
    .content-panel,
    .domain-section,
    .activity-panel,
    .logs-section,
    .search-section,
    .control-section {
        animation: none !important;
    }
    
    .notification {
        animation: none !important;
    }
    
    .spinner {
        animation: none !important;
        border: 2px solid currentColor;
        border-radius: 50%;
    }
}

/* ===== HIGH CONTRAST MODE ===== */
@media (prefers-contrast: high) {
    :root {
        --border-color: #000;
        --text-secondary: #000;
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
    }
    
    .metric-card,
    .chart-container,
    .content-panel,
    .domain-section,
    .activity-panel,
    .logs-section,
    .search-section,
    .control-section {
        border: 2px solid #000 !important;
    }
    
    .btn {
        border: 2px solid currentColor !important;
    }
    
    .form-input,
    .form-select,
    .form-textarea,
    .search-input {
        border: 2px solid #000 !important;
    }
    
    .real-time-item,
    .alert-item,
    .domain-card,
    .control-card {
        border: 1px solid #000 !important;
    }
}

/* ===== ADVANCED ANIMATIONS ===== */
@keyframes slideUp {
    from {
        transform: translateY(30px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes slideDown {
    from {
        transform: translateY(-30px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes slideLeft {
    from {
        transform: translateX(30px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes scaleIn {
    from {
        transform: scale(0.9);
        opacity: 0;
    }
    to {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes bounce {
    0%, 20%, 53%, 80%, 100% {
        transform: translate3d(0, 0, 0);
    }
    40%, 43% {
        transform: translate3d(0, -30px, 0);
    }
    70% {
        transform: translate3d(0, -15px, 0);
    }
    90% {
        transform: translate3d(0, -4px, 0);
    }
}

@keyframes shake {
    0%, 100% {
        transform: translateX(0);
    }
    10%, 30%, 50%, 70%, 90% {
        transform: translateX(-2px);
    }
    20%, 40%, 60%, 80% {
        transform: translateX(2px);
    }
}

@keyframes glow {
    0%, 100% {
        box-shadow: 0 0 5px var(--primary-cyan);
    }
    50% {
        box-shadow: 0 0 20px var(--primary-cyan), 0 0 30px var(--primary-cyan);
    }
}

/* ===== UTILITY ANIMATIONS ===== */
.animate-slide-up {
    animation: slideUp 0.6s ease-out;
}

.animate-slide-down {
    animation: slideDown 0.6s ease-out;
}

.animate-slide-left {
    animation: slideLeft 0.6s ease-out;
}

.animate-scale-in {
    animation: scaleIn 0.4s ease-out;
}

.animate-bounce {
    animation: bounce 1s ease-in-out infinite;
}

.animate-shake {
    animation: shake 0.6s ease-in-out;
}

.animate-glow {
    animation: glow 2s ease-in-out infinite;
}

/* ===== LOADING STATES ===== */
.skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: skeleton-loading 1.5s infinite;
}

@keyframes skeleton-loading {
    0% {
        background-position: 200% 0;
    }
    100% {
        background-position: -200% 0;
    }
}

/* ===== TOUCH DEVICE OPTIMIZATIONS ===== */
@media (hover: none) and (pointer: coarse) {
    .btn,
    .chart-btn,
    .control-btn,
    .domain-card,
    .real-time-item,
    .alert-item {
        min-height: 44px;
        min-width: 44px;
    }
    
    .btn-icon {
        width: 48px;
        height: 48px;
    }
    
    .toggle-switch {
        width: 56px;
        height: 32px;
    }
    
    .toggle-switch::before {
        width: 28px;
        height: 28px;
    }
    
    .toggle-switch:checked::before {
        transform: translateX(24px);
    }
}

    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-cyan-50 to-white">
    
    <!-- Header -->
    <header class="glass-header text-white shadow-xl">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="icon-container">
                        <i class="fas fa-network-wired text-4xl text-cyan-400"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
                            Framework Agentes Multicapa
                        </h1>
                        <p class="text-gray-200">Dashboard de Monitoreo en Tiempo Real</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Controls -->
                    <div class="control-panel">
                        <div class="flex items-center space-x-2">
                            <label class="text-sm text-gray-200">Auto-refresh:</label>
                            <input type="checkbox" id="autoRefreshToggle" checked class="toggle-switch">
                        </div>
                        
                        <select id="domainFilter" class="control-select">
                            <option value="">Todos los dominios</option>
                            <option value="PER">Personal (PER)</option>
                            <option value="ACC">AWS Cloud (ACC)</option>
                            <option value="ACN_FDX">FedEx (ACN_FDX)</option>
                            <option value="JUR">Legal (JUR)</option>
                        </select>
                        
                        <select id="periodFilter" class="control-select">
                            <option value="1">Última hora</option>
                            <option value="24" selected>Últimas 24h</option>
                            <option value="168">Última semana</option>
                            <option value="720">Último mes</option>
                        </select>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="button-group">
                        <button onclick="exportDashboardData()" class="btn-secondary">
                            <i class="fas fa-download mr-1"></i> Exportar
                        </button>
                        
                        <div class="timestamp-display">
                            <div class="text-sm text-gray-200">Última actualización</div>
                            <div id="lastUpdate" class="text-white font-semibold">--:--:--</div>
                        </div>
                        
                        <button onclick="refreshDashboard()" class="btn-primary">
                            <i class="fas fa-sync-alt"></i> Actualizar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Notification System -->
    <div id="notificationContainer" class="notification-container">
        <!-- Notifications will appear here -->
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        
        <!-- Key Metrics -->
        <section class="metrics-grid mb-8">
            <div class="metric-card">
                <div class="metric-header">
                    <div>
                        <p class="metric-label">Agentes Activos</p>
                        <p id="activeAgents" class="metric-value">--</p>
                    </div>
                    <div class="metric-icon bg-gradient-to-br from-cyan-400 to-blue-500">
                        <i class="fas fa-robot"></i>
                    </div>
                </div>
                <div class="metric-trend">
                    <span class="trend-positive">
                        <i class="fas fa-arrow-up"></i> +12%
                    </span>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div>
                        <p class="metric-label">Planes Completados</p>
                        <p id="completedPlans" class="metric-value">--</p>
                    </div>
                    <div class="metric-icon bg-gradient-to-br from-green-400 to-emerald-500">
                        <i class="fas fa-check-circle"></i>
                    </div>
                </div>
                <div class="metric-trend">
                    <span class="trend-positive">
                        <i class="fas fa-arrow-up"></i> +8%
                    </span>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div>
                        <p class="metric-label">Planes en Progreso</p>
                        <p id="inProgressPlans" class="metric-value">--</p>
                    </div>
                    <div class="metric-icon bg-gradient-to-br from-orange-400 to-red-500">
                        <i class="fas fa-cog fa-spin"></i>
                    </div>
                </div>
                <div class="metric-trend">
                    <span class="trend-neutral">
                        <i class="fas fa-minus"></i> 0%
                    </span>
                </div>
            </div>
            
            <div class="metric-card">
                <div class="metric-header">
                    <div>
                        <p class="metric-label">Proyectos Activos</p>
                        <p id="activeProjects" class="metric-value">--</p>
                    </div>
                    <div class="metric-icon bg-gradient-to-br from-purple-400 to-pink-500">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                </div>
                <div class="metric-trend">
                    <span class="trend-positive">
                        <i class="fas fa-arrow-up"></i> +5%
                    </span>
                </div>
            </div>
        </section>

        <!-- Charts Section -->
        <section class="charts-grid mb-8">
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-line text-cyan-500 mr-2"></i>
                        Rendimiento de Agentes por Capa
                    </h3>
                    <div class="chart-controls">
                        <button class="chart-btn active" data-chart="agents">Agentes</button>
                        <button class="chart-btn" data-chart="performance">Performance</button>
                    </div>
                </div>
                <div class="chart-content">
                    <canvas id="agentPerformanceChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-pie text-blue-500 mr-2"></i>
                        Distribución de Estados de Planes
                    </h3>
                    <div class="chart-legend" id="planChartLegend">
                        <!-- Legend will be populated by JavaScript -->
                    </div>
                </div>
                <div class="chart-content">
                    <canvas id="planStatusChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Projects and Action Plans -->
        <section class="content-grid mb-8">
            <div class="content-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-project-diagram text-purple-500 mr-2"></i>
                        Proyectos Activos
                    </h3>
                    <button class="btn-icon" onclick="refreshProjects()">
                        <i class="fas fa-refresh"></i>
                    </button>
                </div>
                <div class="panel-content">
                    <div id="projectsList" class="items-list">
                        <!-- Projects will be loaded here -->
                    </div>
                </div>
            </div>
            
            <div class="content-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-tasks text-cyan-500 mr-2"></i>
                        Planes de Acción Recientes
                    </h3>
                    <button class="btn-icon" onclick="refreshActionPlans()">
                        <i class="fas fa-refresh"></i>
                    </button>
                </div>
                <div class="panel-content">
                    <div id="actionPlansList" class="items-list">
                        <!-- Action plans will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Domain Activity -->
        <section class="domain-section mb-8">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-building text-yellow-500 mr-2"></i>
                    Actividad por Dominio Operativo
                </h3>
                <div class="section-controls">
                    <button class="control-btn active" data-view="grid">Grid</button>
                    <button class="control-btn" data-view="list">Lista</button>
                </div>
            </div>
            <div id="domainActivity" class="domain-grid">
                <!-- Domain activity will be loaded here -->
            </div>
        </section>

        <!-- Real-time Activity -->
        <section class="activity-grid mb-8">
            <div class="activity-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-clock text-cyan-500 mr-2"></i>
                        Tareas en Tiempo Real
                    </h3>
                    <div class="status-indicator active"></div>
                </div>
                <div class="panel-content">
                    <div id="realTimeTasks" class="real-time-list">
                        <!-- Real-time tasks will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="activity-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-trophy text-yellow-500 mr-2"></i>
                        Top Agentes (24h)
                    </h3>
                    <button class="btn-icon" onclick="refreshTopAgents()">
                        <i class="fas fa-medal"></i>
                    </button>
                </div>
                <div class="panel-content">
                    <div id="topAgents" class="top-agents-list">
                        <!-- Top agents will be loaded here -->
                    </div>
                </div>
            </div>

            <div class="activity-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                        Alertas del Sistema
                    </h3>
                    <div class="alert-counter" id="alertCount">0</div>
                </div>
                <div class="panel-content">
                    <div id="systemAlerts" class="alerts-list">
                        <!-- System alerts will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- System Logs -->
        <section class="logs-section mb-8">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-list-alt text-blue-500 mr-2"></i>
                    Actividad Reciente del Sistema
                </h3>
                <div class="log-controls">
                    <select id="logLevelFilter" class="control-select small">
                        <option value="">Todos los niveles</option>
                        <option value="error">Error</option>
                        <option value="warning">Warning</option>
                        <option value="info">Info</option>
                        <option value="debug">Debug</option>
                    </select>
                    <button class="btn-icon" onclick="clearLogs()">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
            <div class="logs-container">
                <div id="systemLogs" class="logs-list">
                    <!-- System logs will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Advanced Search -->
        <section class="search-section mb-8">
            <div class="search-panel">
                <div class="panel-header">
                    <h3 class="panel-title">
                        <i class="fas fa-search text-cyan-500 mr-2"></i>
                        Búsqueda Avanzada
                    </h3>
                </div>
                <div class="panel-content">
                    <div class="search-form">
                        <div class="search-input-group">
                            <input type="text" id="searchInput" 
                                   placeholder="Buscar en logs, planes, proyectos..." 
                                   class="search-input">
                            <div class="search-filters">
                                <select id="searchCategory" class="control-select">
                                    <option value="">Todas las categorías</option>
                                    <option value="logs">Logs del Sistema</option>
                                    <option value="plans">Planes de Acción</option>
                                    <option value="projects">Proyectos</option>
                                    <option value="agents">Agentes</option>
                                </select>
                                <button onclick="performAdvancedSearch()" class="btn-primary">
                                    <i class="fas fa-search mr-2"></i>Buscar
                                </button>
                            </div>
                        </div>
                    </div>
                    <div id="searchResults" class="search-results">
                        <!-- Search results will appear here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Control Panel -->
        <section class="control-section mb-8">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-cogs text-green-500 mr-2"></i>
                    Panel de Control de Agentes
                </h3>
            </div>
            <div class="control-grid">
                <div class="control-card">
                    <h4 class="control-card-title">Crear Plan de Acción</h4>
                    <div class="control-form">
                        <textarea id="newPlanRequest" 
                                  placeholder="Describe tu solicitud aquí..." 
                                  class="form-textarea" rows="3"></textarea>
                        <select id="planPriority" class="form-select">
                            <option value="3">Prioridad Normal</option>
                            <option value="5">Prioridad Alta</option>
                            <option value="1">Prioridad Baja</option>
                        </select>
                        <button onclick="createNewActionPlan()" class="btn-success full-width">
                            <i class="fas fa-plus mr-2"></i>Crear Plan
                        </button>
                    </div>
                </div>
                
                <div class="control-card">
                    <h4 class="control-card-title">Registro Manual</h4>
                    <div class="control-form">
                        <select id="logLevel" class="form-select">
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                        </select>
                        <input type="text" id="logMessage" 
                               placeholder="Mensaje del log..." 
                               class="form-input">
                        <button onclick="createManualLog()" class="btn-warning full-width">
                            <i class="fas fa-pen mr-2"></i>Registrar
                        </button>
                    </div>
                </div>

                <div class="control-card">
                    <h4 class="control-card-title">Estado del Sistema</h4>
                    <div class="system-status">
                        <div class="status-item">
                            <span class="status-label">Base de Datos:</span>
                            <span id="dbStatus" class="status-dot active"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">API Supabase:</span>
                            <span id="apiStatus" class="status-dot active"></span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Agentes n8n:</span>
                            <span id="n8nStatus" class="status-dot warning"></span>
                        </div>
                        <button onclick="checkSystemHealth()" class="btn-info full-width">
                            <i class="fas fa-heartbeat mr-2"></i>Verificar Estado
                        </button>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container mx-auto px-6 py-4 text-center">
            <p class="text-gray-600">
                &copy; 2024 Framework Agentes Multicapa - Dashboard de Monitoreo
            </p>
        </div>
    </footer>

    <!-- Scripts -->
    
    
    
    

    <!-- Scripts Consolidados -->
    <script>
        // Variables globales del dashboard
const DASHBOARD_CONFIG = {
    autoRefreshInterval: 30000, // 30 segundos
    maxRetries: 3,
    retryDelay: 2000,
    defaultDomain: '',
    defaultPeriod: 24, // horas
    
    // Configuración de gráficos
    charts: {
        agentPerformance: null,
        planStatus: null
    },
    
    // Estado del dashboard
    state: {
        isAutoRefreshEnabled: true,
        currentDomain: '',
        currentPeriod: 24,
        lastUpdate: null,
        isLoading: false
    },
    
    // Intervalos
    intervals: {
        autoRefresh: null,
        realTime: null
    }
};

// Configuración de colores para gráficos
const CHART_COLORS = {
    primary: '#06b6d4',
    secondary: '#14b8a6',
    success: '#10b981',
    warning: '#f59e0b',
    danger: '#ef4444',
    info: '#3b82f6',
    purple: '#8b5cf6',
    pink: '#ec4899',
    
    // Paleta para estados de planes
    planStatus: {
        'completed': '#10b981',
        'in_progress': '#f59e0b',
        'pending': '#6b7280',
        'cancelled': '#ef4444',
        'on_hold': '#8b5cf6'
    },
    
    // Paleta para capas de agentes
    agentLayers: {
        'layer_1': '#06b6d4',
        'layer_2': '#14b8a6',
        'layer_3': '#3b82f6',
        'layer_4': '#8b5cf6',
        'layer_5': '#ec4899'
    }
};

// Mapeo de dominios
const DOMAIN_MAPPING = {
    'PER': 'Personal',
    'ACC': 'AWS Cloud',
    'ACN_FDX': 'FedEx',
    'JUR': 'Legal'
};

// Configuración de logs
const LOG_LEVELS = {
    error: { color: '#ef4444', icon: 'fas fa-exclamation-circle' },
    warning: { color: '#f59e0b', icon: 'fas fa-exclamation-triangle' },
    info: { color: '#3b82f6', icon: 'fas fa-info-circle' },
    debug: { color: '#6b7280', icon: 'fas fa-bug' }
};



/* ===== CONFIGURACIÓN - Supabase y Variables Globales ===== */

// Configuración de Supabase
const SUPABASE_CONFIG = {
    url: 'https://irhcudgyudmwwoamtwoo.supabase.co', // Reemplazar con tu URL de Supabase
    key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlyaGN1ZGd5dWRtd3dvYW10d29vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2ODQyMjksImV4cCI6MjA2NzI2MDIyOX0.kDQRr5H3jsBabERN2blVRAiGOaU4E2TnikYp19wOv28', // Reemplazar con tu clave anónima de Supabase
};

// Inicializar cliente de Supabase
let supabase;

// Inicialización
document.addEventListener('DOMContentLoaded', function() {
    // Verificar que las librerías estén cargadas
    if (typeof window.supabase === 'undefined') {
        console.error('Supabase library not loaded');
        showNotification('Error: Biblioteca de Supabase no cargada', 'error');
        return;
    }

    // Crear cliente de Supabase
    try {
        supabase = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
        console.log('Supabase client initialized successfully');
        
        // Inicializar dashboard
        initializeDashboard();
    } catch (error) {
        console.error('Error initializing Supabase:', error);
        showNotification('Error conectando con la base de datos', 'error');
    }
});

// Utilidades globales
const Utils = {
    // Formatear fecha
    formatDate: (date) => {
        if (!date) return '--';
        const d = new Date(date);
        return d.toLocaleDateString('es-ES', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    },
    
    // Formatear fecha relativa
    formatRelativeTime: (date) => {
        if (!date) return '--';
        const now = new Date();
        const then = new Date(date);
        const diffMs = now - then;
        const diffMins = Math.floor(diffMs / 60000);
        const diffHours = Math.floor(diffMins / 60);
        const diffDays = Math.floor(diffHours / 24);
        
        if (diffMins < 1) return 'Ahora';
        if (diffMins < 60) return `${diffMins}m`;
        if (diffHours < 24) return `${diffHours}h`;
        return `${diffDays}d`;
    },
    
    // Capitalizar primera letra
    capitalize: (str) => {
        if (!str) return '';
        return str.charAt(0).toUpperCase() + str.slice(1);
    },
    
    // Truncar texto
    truncate: (str, length = 50) => {
        if (!str) return '';
        return str.length > length ? str.substring(0, length) + '...' : str;
    },
    
    // Debounce function
    debounce: (func, wait) => {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    },
    
    // Retry function
    retry: async (fn, retries = DASHBOARD_CONFIG.maxRetries) => {
        try {
            return await fn();
        } catch (error) {
            if (retries > 0) {
                await new Promise(resolve => setTimeout(resolve, DASHBOARD_CONFIG.retryDelay));
                return Utils.retry(fn, retries - 1);
            }
            throw error;
        }
    },
    
    // Validar configuración de Supabase
    validateSupabaseConfig: () => {
        if (SUPABASE_CONFIG.url === 'https://irhcudgyudmwwoamtwoo.supabase.co' || 
            SUPABASE_CONFIG.key === 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlyaGN1ZGd5dWRtd3dvYW10d29vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2ODQyMjksImV4cCI6MjA2NzI2MDIyOX0.kDQRr5H3jsBabERN2blVRAiGOaU4E2TnikYp19wOv28') {
            return false;
        }
        return true;
    }
};

// Exportar configuraciones para otros módulos
window.DASHBOARD_CONFIG = DASHBOARD_CONFIG;
window.CHART_COLORS = CHART_COLORS;
window.DOMAIN_MAPPING = DOMAIN_MAPPING;
window.LOG_LEVELS = LOG_LEVELS;
window.Utils = Utils;

        /* ===== UTILS - Funciones Auxiliares y Complementarias ===== */

// Sistema de notificaciones
function showNotification(message, type = 'info', duration = 5000) {
    const container = document.getElementById('notificationContainer');
    if (!container) return;
    
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    
    const icons = {
        success: 'fas fa-check-circle',
        error: 'fas fa-exclamation-circle',
        warning: 'fas fa-exclamation-triangle',
        info: 'fas fa-info-circle'
    };
    
    notification.innerHTML = `
        <div class="notification-icon">
            <i class="${icons[type] || icons.info}"></i>
        </div>
        <div class="notification-content">
            <p class="notification-message">${message}</p>
        </div>
        <button class="notification-close" onclick="closeNotification(this)">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    container.appendChild(notification);
    
    // Auto-remove después del tiempo especificado
    setTimeout(() => {
        if (notification.parentNode) {
            closeNotification(notification.querySelector('.notification-close'));
        }
    }, duration);
}

function closeNotification(button) {
    const notification = button.closest('.notification');
    if (notification) {
        notification.style.animation = 'slideOutRight 0.3s ease-in-out';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }
}

// Funciones específicas del dashboard (llamadas desde HTML)
function refreshProjects() {
    loadProjects();
    showNotification('Proyectos actualizados', 'success');
}

function refreshActionPlans() {
    loadActionPlans();
    showNotification('Planes de acción actualizados', 'success');
}

function refreshTopAgents() {
    loadTopAgents();
    showNotification('Top agentes actualizado', 'success');
}

// Crear nuevo plan de acción
async function createNewActionPlan() {
    const requestTextarea = document.getElementById('newPlanRequest');
    const prioritySelect = document.getElementById('planPriority');
    
    if (!requestTextarea || !prioritySelect) return;
    
    const request = requestTextarea.value.trim();
    const priority = parseInt(prioritySelect.value);
    
    if (!request) {
        showNotification('Por favor ingresa una descripción del plan', 'warning');
        return;
    }
    
    try {
        if (supabase) {
            const { data, error } = await supabase
                .from('action_plans')
                .insert([{
                    initial_request: request,
                    priority: priority,
                    status: 'pending',
                    domain: DASHBOARD_CONFIG.state.currentDomain || 'PER',
                    created_at: new Date().toISOString()
                }]);
                
            if (error) throw error;
            
            showNotification('Plan de acción creado exitosamente', 'success');
            requestTextarea.value = '';
            prioritySelect.value = '3';
            
            // Actualizar dashboard
            await loadActionPlans();
            await loadMetrics();
            
        } else {
            // Modo demo
            showNotification('Plan creado (modo demo)', 'info');
            requestTextarea.value = '';
        }
        
    } catch (error) {
        console.error('Error creating action plan:', error);
        showNotification('Error creando el plan de acción', 'error');
    }
}

// Crear log manual
async function createManualLog() {
    const levelSelect = document.getElementById('logLevel');
    const messageInput = document.getElementById('logMessage');
    
    if (!levelSelect || !messageInput) return;
    
    const level = levelSelect.value;
    const message = messageInput.value.trim();
    
    if (!message) {
        showNotification('Por favor ingresa un mensaje', 'warning');
        return;
    }
    
    try {
        // Agregar log al DOM
        const systemLogs = document.getElementById('systemLogs');
        if (systemLogs) {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry animate-slide-up';
            logEntry.innerHTML = `
                <span class="log-timestamp">${Utils.formatDate(new Date())}</span>
                <span class="log-level ${level}">
                    <i class="${LOG_LEVELS[level].icon}"></i>
                    ${level.toUpperCase()}
                </span>
                <span class="log-message">${message}</span>
            `;
            
            systemLogs.insertBefore(logEntry, systemLogs.firstChild);
        }
        
        showNotification('Log registrado exitosamente', 'success');
        messageInput.value = '';
        
    } catch (error) {
        console.error('Error creating manual log:', error);
        showNotification('Error registrando el log', 'error');
    }
}

// Verificar estado del sistema
async function checkSystemHealth() {
    const dbStatus = document.getElementById('dbStatus');
    const apiStatus = document.getElementById('apiStatus');
    const n8nStatus = document.getElementById('n8nStatus');
    
    try {
        // Verificar conexión a Supabase
        if (supabase) {
            const { data, error } = await supabase.from('action_plans').select('id').limit(1);
            
            if (dbStatus) {
                dbStatus.className = error ? 'status-dot error' : 'status-dot active';
            }
            if (apiStatus) {
                apiStatus.className = error ? 'status-dot error' : 'status-dot active';
            }
        } else {
            if (dbStatus) dbStatus.className = 'status-dot warning';
            if (apiStatus) apiStatus.className = 'status-dot warning';
        }
        
        // n8n status (simulado)
        if (n8nStatus) {
            n8nStatus.className = 'status-dot warning';
        }
        
        showNotification('Estado del sistema verificado', 'info');
        
    } catch (error) {
        console.error('Error checking system health:', error);
        if (dbStatus) dbStatus.className = 'status-dot error';
        if (apiStatus) apiStatus.className = 'status-dot error';
        showNotification('Error verificando el estado del sistema', 'error');
    }
}

// Búsqueda avanzada
async function performAdvancedSearch() {
    const searchInput = document.getElementById('searchInput');
    const categorySelect = document.getElementById('searchCategory');
    const resultsContainer = document.getElementById('searchResults');
    
    if (!searchInput || !categorySelect || !resultsContainer) return;
    
    const query = searchInput.value.trim();
    const category = categorySelect.value;
    
    if (!query) {
        resultsContainer.innerHTML = '';
        return;
    }
    
    try {
        resultsContainer.innerHTML = '<div class="text-center py-4"><i class="fas fa-spinner fa-spin text-cyan-500"></i> Buscando...</div>';
        
        let results = [];
        
        if (supabase) {
            if (category === '' || category === 'plans') {
                const { data } = await supabase
                    .from('action_plans')
                    .select('*')
                    .or(`initial_request.ilike.%${query}%,domain.ilike.%${query}%`)
                    .limit(10);
                    
                if (data) {
                    results = [...results, ...data.map(item => ({
                        ...item,
                        type: 'plan',
                        title: item.initial_request,
                        subtitle: `Dominio: ${DOMAIN_MAPPING[item.domain] || item.domain}`
                    }))];
                }
            }
        }
        
        // Mostrar resultados
        if (results.length > 0) {
            resultsContainer.innerHTML = results.map(result => `
                <div class="search-result-item animate-slide-up">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900">${Utils.truncate(result.title, 60)}</h4>
                            <p class="text-sm text-gray-600">${result.subtitle}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="badge badge-secondary">${Utils.capitalize(result.type)}</span>
                            <span class="text-xs text-gray-500">${Utils.formatRelativeTime(result.created_at)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        } else {
            resultsContainer.innerHTML = '<div class="text-center py-8 text-gray-500">No se encontraron resultados</div>';
        }
        
    } catch (error) {
        console.error('Error performing search:', error);
        resultsContainer.innerHTML = '<div class="text-center py-4 text-red-500">Error en la búsqueda</div>';
    }
}

// Exportar datos del dashboard
function exportDashboardData() {
    try {
        const data = {
            timestamp: new Date().toISOString(),
            metrics: {
                activeAgents: document.getElementById('activeAgents')?.textContent || '0',
                completedPlans: document.getElementById('completedPlans')?.textContent || '0',
                inProgressPlans: document.getElementById('inProgressPlans')?.textContent || '0',
                activeProjects: document.getElementById('activeProjects')?.textContent || '0'
            },
            lastUpdate: DASHBOARD_CONFIG.state.lastUpdate,
            currentFilters: {
                domain: DASHBOARD_CONFIG.state.currentDomain,
                period: DASHBOARD_CONFIG.state.currentPeriod
            }
        };
        
        const dataStr = JSON.stringify(data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = `dashboard-export-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        showNotification('Datos exportados exitosamente', 'success');
        
    } catch (error) {
        console.error('Error exporting data:', error);
        showNotification('Error exportando datos', 'error');
    }
}

// Limpiar logs
function clearLogs() {
    const systemLogs = document.getElementById('systemLogs');
    if (systemLogs) {
        systemLogs.innerHTML = '<div class="text-center py-8 text-gray-500">Logs limpiados</div>';
        showNotification('Logs limpiados', 'info');
    }
}

// Alternar vista de dominio
function toggleDomainView(view) {
    const buttons = document.querySelectorAll('[data-view]');
    buttons.forEach(btn => btn.classList.remove('active'));
    
    const activeButton = document.querySelector(`[data-view="${view}"]`);
    if (activeButton) {
        activeButton.classList.add('active');
    }
    
    const domainGrid = document.getElementById('domainActivity');
    if (domainGrid) {
        if (view === 'list') {
            domainGrid.style.gridTemplateColumns = '1fr';
        } else {
            domainGrid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(200px, 1fr))';
        }
    }
}

// Funciones para mostrar datos de prueba cuando no hay conexión a Supabase
function showTestData() {
    showTestProjects();
    showTestActionPlans();
    showTestDomainActivity();
    showTestRealTimeTasks();
    showTestTopAgents();
    showTestAlerts();
    showTestLogs();
    
    // Métricas de prueba
    updateMetricCard('activeAgents', 12);
    updateMetricCard('completedPlans', 847);
    updateMetricCard('inProgressPlans', 23);
    updateMetricCard('activeProjects', 8);
}

function showTestProjects() {
    const projectsList = document.getElementById('projectsList');
    if (projectsList) {
        projectsList.innerHTML = `
            <div class="real-time-item animate-slide-up">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900">Automatización de reportes AWS</h4>
                        <p class="text-sm text-gray-600">AWS Cloud</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="badge badge-success">Activo</span>
                        <span class="text-xs text-gray-500">2h</span>
                    </div>
                </div>
            </div>
            <div class="real-time-item animate-slide-up">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900">Gestión de documentos legales</h4>
                        <p class="text-sm text-gray-600">Legal</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="badge badge-warning">En Progreso</span>
                        <span class="text-xs text-gray-500">4h</span>
                    </div>
                </div>
            </div>
        `;
    }
}

function showTestActionPlans() {
    const actionPlansList = document.getElementById('actionPlansList');
    if (actionPlansList) {
        actionPlansList.innerHTML = `
            <div class="real-time-item animate-slide-up">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900">Optimizar pipeline de datos</h4>
                        <p class="text-sm text-gray-600">Prioridad: 5</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="badge badge-success">Completado</span>
                        <span class="text-xs text-gray-500">1h</span>
                    </div>
                </div>
            </div>
            <div class="real-time-item animate-slide-up">
                <div class="flex items-center justify-between">
                    <div class="flex-1">
                        <h4 class="font-semibold text-gray-900">Revisar contratos FedEx</h4>
                        <p class="text-sm text-gray-600">Prioridad: 3</p>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="badge badge-warning">En Progreso</span>
                        <span class="text-xs text-gray-500">3h</span>
                    </div>
                </div>
            </div>
        `;
    }
}

function showTestDomainActivity() {
    const domainActivity = document.getElementById('domainActivity');
    if (domainActivity) {
        domainActivity.innerHTML = `
            <div class="domain-card animate-scale-in">
                <div class="domain-name">Personal</div>
                <div class="domain-stats">
                    <div class="stat-item">
                        <span class="stat-label">Total</span>
                        <span class="stat-value">156</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Completados</span>
                        <span class="stat-value">134</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">En Progreso</span>
                        <span class="stat-value">22</span>
                    </div>
                </div>
            </div>
            <div class="domain-card animate-scale-in">
                <div class="domain-name">AWS Cloud</div>
                <div class="domain-stats">
                    <div class="stat-item">
                        <span class="stat-label">Total</span>
                        <span class="stat-value">89</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Completados</span>
                        <span class="stat-value">67</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">En Progreso</span>
                        <span class="stat-value">22</span>
                    </div>
                </div>
            </div>
        `;
    }
}

function showTestRealTimeTasks() {
    const realTimeTasks = document.getElementById('realTimeTasks');
    if (realTimeTasks) {
        realTimeTasks.innerHTML = `
            <div class="real-time-item animate-slide-left">
                <div class="status-indicator active"></div>
                <div class="flex-1">
                    <h4 class="font-medium text-gray-900">Procesando archivos CSV</h4>
                    <p class="text-xs text-gray-500">Personal • 2m</p>
                </div>
            </div>
            <div class="real-time-item animate-slide-left">
                <div class="status-indicator active"></div>
                <div class="flex-1">
                    <h4 class="font-medium text-gray-900">Sincronizando con AWS</h4>
                    <p class="text-xs text-gray-500">AWS Cloud • 5m</p>
                </div>
            </div>
        `;
    }
}

function showTestTopAgents() {
    const topAgents = document.getElementById('topAgents');
    if (topAgents) {
        topAgents.innerHTML = `
            <div class="real-time-item animate-slide-left">
                <div class="flex items-center space-x-3">
                    <div class="text-cyan-500 font-bold">#1</div>
                    <div class="flex-1">
                        <h4 class="font-medium text-gray-900">AWS Cloud</h4>
                        <p class="text-xs text-gray-500">67 tareas completadas</p>
                    </div>
                    <div class="text-cyan-500"><i class="fas fa-trophy"></i></div>
                </div>
            </div>
            <div class="real-time-item animate-slide-left">
                <div class="flex items-center space-x-3">
                    <div class="text-cyan-500 font-bold">#2</div>
                    <div class="flex-1">
                        <h4 class="font-medium text-gray-900">Personal</h4>
                        <p class="text-xs text-gray-500">45 tareas completadas</p>
                    </div>
                    <div class="text-cyan-500"><i class="fas fa-medal"></i></div>
                </div>
            </div>
        `;
    }
}

function showTestAlerts() {
    const systemAlerts = document.getElementById('systemAlerts');
    const alertCount = document.getElementById('alertCount');
    
    if (alertCount) alertCount.textContent = '2';
    
    if (systemAlerts) {
        systemAlerts.innerHTML = `
            <div class="alert-item animate-slide-up">
                <div class="flex items-center space-x-3">
                    <div class="text-yellow-500"><i class="fas fa-exclamation-triangle"></i></div>
                    <div class="flex-1">
                        <h4 class="font-medium text-gray-900">Alta carga en servidor</h4>
                        <p class="text-xs text-gray-500">CPU al 85% • 10m</p>
                    </div>
                </div>
            </div>
            <div class="alert-item animate-slide-up">
                <div class="flex items-center space-x-3">
                    <div class="text-blue-500"><i class="fas fa-info-circle"></i></div>
                    <div class="flex-1">
                        <h4 class="font-medium text-gray-900">Actualización disponible</h4>
                        <p class="text-xs text-gray-500">n8n v1.2.3 • 1h</p>
                    </div>
                </div>
            </div>
        `;
    }
}

function showTestLogs() {
    const systemLogs = document.getElementById('systemLogs');
    if (systemLogs) {
        systemLogs.innerHTML = `
            <div class="log-entry animate-slide-up">
                <span class="log-timestamp">${Utils.formatDate(new Date())}</span>
                <span class="log-level info">
                    <i class="${LOG_LEVELS.info.icon}"></i>
                    INFO
                </span>
                <span class="log-message">Sistema iniciado correctamente</span>
            </div>
            <div class="log-entry animate-slide-up">
                <span class="log-timestamp">${Utils.formatDate(new Date(Date.now() - 300000))}</span>
                <span class="log-level warning">
                    <i class="${LOG_LEVELS.warning.icon}"></i>
                    WARNING
                </span>
                <span class="log-message">Conexión a base de datos lenta</span>
            </div>
            <div class="log-entry animate-slide-up">
                <span class="log-timestamp">${Utils.formatDate(new Date(Date.now() - 600000))}</span>
                <span class="log-level info">
                    <i class="${LOG_LEVELS.info.icon}"></i>
                    INFO
                </span>
                <span class="log-message">Nuevo plan de acción procesado</span>
            </div>
            <div class="log-entry animate-slide-up">
                <span class="log-timestamp">${Utils.formatDate(new Date(Date.now() - 900000))}</span>
                <span class="log-level error">
                    <i class="${LOG_LEVELS.error.icon}"></i>
                    ERROR
                </span>
                <span class="log-message">Error temporal en API externa</span>
            </div>
        `;
    }
}

// Filtrar logs por nivel
function filterLogs() {
    const logLevelFilter = document.getElementById('logLevelFilter');
    const systemLogs = document.getElementById('systemLogs');
    
    if (!logLevelFilter || !systemLogs) return;
    
    const selectedLevel = logLevelFilter.value;
    const logEntries = systemLogs.querySelectorAll('.log-entry');
    
    logEntries.forEach(entry => {
        if (!selectedLevel) {
            entry.style.display = 'flex';
        } else {
            const levelSpan = entry.querySelector('.log-level');
            if (levelSpan && levelSpan.textContent.toLowerCase().includes(selectedLevel)) {
                entry.style.display = 'flex';
            } else {
                entry.style.display = 'none';
            }
        }
    });
}

// Configurar filtro de logs
document.addEventListener('DOMContentLoaded', function() {
    const logLevelFilter = document.getElementById('logLevelFilter');
    if (logLevelFilter) {
        logLevelFilter.addEventListener('change', filterLogs);
    }
});

// Validación de formularios
function validateForm(formId) {
    const form = document.getElementById(formId);
    if (!form) return false;
    
    const requiredFields = form.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!field.value.trim()) {
            field.classList.add('error');
            isValid = false;
        } else {
            field.classList.remove('error');
        }
    });
    
    return isValid;
}

// Formatear números para métricas
function formatMetricNumber(num) {
    if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
    } else if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
    }
    return num.toString();
}

// Detectar tema del sistema
function detectSystemTheme() {
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark-theme');
    }
    
    // Escuchar cambios en el tema
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (e.matches) {
            document.body.classList.add('dark-theme');
        } else {
            document.body.classList.remove('dark-theme');
        }
    });
}

// Gestión de estado de carga
function setComponentLoading(elementId, isLoading) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    if (isLoading) {
        element.classList.add('is-loading');
        element.innerHTML = `
            <div class="loading-overlay">
                <div class="spinner"></div>
            </div>
        `;
    } else {
        element.classList.remove('is-loading');
        const overlay = element.querySelector('.loading-overlay');
        if (overlay) {
            overlay.remove();
        }
    }
}

// Gestión de shortcuts de teclado
function setupKeyboardShortcuts() {
    document.addEventListener('keydown', function(e) {
        // Ctrl/Cmd + R: Actualizar dashboard
        if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
            e.preventDefault();
            refreshDashboard();
            showNotification('Dashboard actualizado (atajo de teclado)', 'info');
        }
        
        // Ctrl/Cmd + K: Enfocar búsqueda
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.focus();
                searchInput.select();
            }
        }
        
        // Escape: Cerrar modales/limpiar búsqueda
        if (e.key === 'Escape') {
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            if (searchInput && searchResults) {
                searchInput.value = '';
                searchResults.innerHTML = '';
            }
        }
    });
}

// Gestión de persistencia local
const LocalStorage = {
    // Guardar preferencias del usuario
    savePreferences: (preferences) => {
        try {
            localStorage.setItem('dashboard-preferences', JSON.stringify(preferences));
        } catch (error) {
            console.warn('Could not save preferences to localStorage:', error);
        }
    },
    
    // Cargar preferencias del usuario
    loadPreferences: () => {
        try {
            const saved = localStorage.getItem('dashboard-preferences');
            return saved ? JSON.parse(saved) : null;
        } catch (error) {
            console.warn('Could not load preferences from localStorage:', error);
            return null;
        }
    },
    
    // Guardar estado de filtros
    saveFilters: (filters) => {
        try {
            localStorage.setItem('dashboard-filters', JSON.stringify(filters));
        } catch (error) {
            console.warn('Could not save filters to localStorage:', error);
        }
    },
    
    // Cargar estado de filtros
    loadFilters: () => {
        try {
            const saved = localStorage.getItem('dashboard-filters');
            return saved ? JSON.parse(saved) : null;
        } catch (error) {
            console.warn('Could not load filters from localStorage:', error);
            return null;
        }
    }
};

// Aplicar preferencias guardadas
function applyStoredPreferences() {
    const preferences = LocalStorage.loadPreferences();
    if (preferences) {
        // Aplicar tema
        if (preferences.theme) {
            document.body.classList.toggle('dark-theme', preferences.theme === 'dark');
        }
        
        // Aplicar auto-refresh
        if (preferences.autoRefresh !== undefined) {
            const toggle = document.getElementById('autoRefreshToggle');
            if (toggle) {
                toggle.checked = preferences.autoRefresh;
                DASHBOARD_CONFIG.state.isAutoRefreshEnabled = preferences.autoRefresh;
            }
        }
    }
    
    const filters = LocalStorage.loadFilters();
    if (filters) {
        // Aplicar filtros de dominio y período
        const domainFilter = document.getElementById('domainFilter');
        const periodFilter = document.getElementById('periodFilter');
        
        if (domainFilter && filters.domain) {
            domainFilter.value = filters.domain;
            DASHBOARD_CONFIG.state.currentDomain = filters.domain;
        }
        
        if (periodFilter && filters.period) {
            periodFilter.value = filters.period;
            DASHBOARD_CONFIG.state.currentPeriod = filters.period;
        }
    }
}

// Guardar preferencias actuales
function saveCurrentPreferences() {
    const preferences = {
        theme: document.body.classList.contains('dark-theme') ? 'dark' : 'light',
        autoRefresh: DASHBOARD_CONFIG.state.isAutoRefreshEnabled
    };
    
    const filters = {
        domain: DASHBOARD_CONFIG.state.currentDomain,
        period: DASHBOARD_CONFIG.state.currentPeriod
    };
    
    LocalStorage.savePreferences(preferences);
    LocalStorage.saveFilters(filters);
}

// Configurar observador de cambios para guardar automáticamente
function setupAutoSave() {
    // Guardar preferencias cuando cambie el auto-refresh
    const autoRefreshToggle = document.getElementById('autoRefreshToggle');
    if (autoRefreshToggle) {
        autoRefreshToggle.addEventListener('change', saveCurrentPreferences);
    }
    
    // Guardar filtros cuando cambien
    const domainFilter = document.getElementById('domainFilter');
    const periodFilter = document.getElementById('periodFilter');
    
    if (domainFilter) {
        domainFilter.addEventListener('change', saveCurrentPreferences);
    }
    
    if (periodFilter) {
        periodFilter.addEventListener('change', saveCurrentPreferences);
    }
}

// Gestión de conexión de red
function setupNetworkMonitoring() {
    window.addEventListener('online', () => {
        showNotification('Conexión restaurada', 'success');
        refreshDashboard();
    });
    
    window.addEventListener('offline', () => {
        showNotification('Conexión perdida - modo offline', 'warning');
    });
}

// Inicialización de utilidades
function initializeUtils() {
    detectSystemTheme();
    setupKeyboardShortcuts();
    applyStoredPreferences();
    setupAutoSave();
    setupNetworkMonitoring();
}

// CSS dinámico para animaciones
const animationCSS = `
@keyframes slideOutRight {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(100%);
        opacity: 0;
    }
}

.search-result-item {
    background: white;
    border-radius: 0.75rem;
    padding: 1rem;
    border: 1px solid #e2e8f0;
    margin-bottom: 0.5rem;
    transition: all 0.3s ease;
}

.search-result-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.alert-item {
    background: white;
    border-radius: 0.75rem;
    padding: 0.75rem;
    border: 1px solid #e2e8f0;
    margin-bottom: 0.5rem;
    transition: all 0.3s ease;
}

.alert-item:hover {
    background: #f8fafc;
}

.log-entry {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.5rem;
    border-bottom: 1px solid #f1f5f9;
    font-family: 'Fira Code', monospace;
    font-size: 0.8rem;
}

.log-timestamp {
    color: #64748b;
    min-width: 120px;
}

.log-level {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    min-width: 80px;
    font-weight: 600;
}

.log-level.info { color: #3b82f6; }
.log-level.warning { color: #f59e0b; }
.log-level.error { color: #ef4444; }
.log-level.debug { color: #6b7280; }

.log-message {
    flex: 1;
    color: #1e293b;
}

.form-input.error,
.form-select.error,
.form-textarea.error {
    border-color: #ef4444;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}
`;

// Agregar CSS dinámico al documento
function injectDynamicCSS() {
    const style = document.createElement('style');
    style.textContent = animationCSS;
    document.head.appendChild(style);
}

// Inicialización cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
    initializeUtils();
    injectDynamicCSS();
});

// Exportar funciones para uso global
window.showNotification = showNotification;
window.refreshProjects = refreshProjects;
window.refreshActionPlans = refreshActionPlans;
window.refreshTopAgents = refreshTopAgents;
window.createNewActionPlan = createNewActionPlan;
window.createManualLog = createManualLog;
window.checkSystemHealth = checkSystemHealth;
window.performAdvancedSearch = performAdvancedSearch;
window.exportDashboardData = exportDashboardData;
window.clearLogs = clearLogs;
window.toggleDomainView = toggleDomainView;



/* ===== DASHBOARD - Lógica Principal y Funciones Core ===== */

// Inicialización del Dashboard
async function initializeDashboard() {
    console.log('Initializing dashboard...');
    
    // Verificar configuración
    if (!Utils.validateSupabaseConfig()) {
        showNotification('Por favor configura las credenciales de Supabase en config.js', 'warning');
        showTestData();
        return;
    }
    
    try {
        // Configurar event listeners
        setupEventListeners();
        
        // Cargar datos iniciales
        await loadDashboardData();
        
        // Configurar auto-refresh
        setupAutoRefresh();
        
        // Inicializar sistema de tiempo real
        setupRealTimeUpdates();
        
        showNotification('Dashboard inicializado correctamente', 'success');
        
    } catch (error) {
        console.error('Error initializing dashboard:', error);
        showNotification('Error inicializando dashboard', 'error');
        showTestData();
    }
}

// Configurar Event Listeners
function setupEventListeners() {
    // Auto-refresh toggle
    const autoRefreshToggle = document.getElementById('autoRefreshToggle');
    if (autoRefreshToggle) {
        autoRefreshToggle.addEventListener('change', (e) => {
            DASHBOARD_CONFIG.state.isAutoRefreshEnabled = e.target.checked;
            if (e.target.checked) {
                setupAutoRefresh();
            } else {
                clearInterval(DASHBOARD_CONFIG.intervals.autoRefresh);
            }
        });
    }
    
    // Filtros
    const domainFilter = document.getElementById('domainFilter');
    if (domainFilter) {
        domainFilter.addEventListener('change', (e) => {
            DASHBOARD_CONFIG.state.currentDomain = e.target.value;
            refreshDashboard();
        });
    }
    
    const periodFilter = document.getElementById('periodFilter');
    if (periodFilter) {
        periodFilter.addEventListener('change', (e) => {
            DASHBOARD_CONFIG.state.currentPeriod = parseInt(e.target.value);
            refreshDashboard();
        });
    }
    
    // Búsqueda
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        searchInput.addEventListener('input', Utils.debounce((e) => {
            performAdvancedSearch();
        }, 500));
    }
    
    // Control de vistas
    document.querySelectorAll('[data-view]').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const view = e.target.dataset.view;
            toggleDomainView(view);
        });
    });
    
    // Controles de gráficos
    document.querySelectorAll('[data-chart]').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const chartType = e.target.dataset.chart;
            toggleChartView(chartType);
        });
    });
}

// Cargar datos del dashboard
async function loadDashboardData() {
    try {
        setLoadingState(true);
        
        // Cargar todas las secciones en paralelo
        const promises = [
            loadMetrics(),
            loadProjects(),
            loadActionPlans(),
            loadDomainActivity(),
            loadRealTimeTasks(),
            loadTopAgents(),
            loadSystemAlerts(),
            loadSystemLogs()
        ];
        
        await Promise.allSettled(promises);
        
        // Actualizar timestamp
        updateLastUpdateTime();
        
    } catch (error) {
        console.error('Error loading dashboard data:', error);
        throw error;
    } finally {
        setLoadingState(false);
    }
}

// Cargar métricas principales
async function loadMetrics() {
    try {
        // Consultas a las diferentes tablas
        const [agentsResult, plansResult, projectsResult] = await Promise.all([
            supabase.from('action_plans').select('*', { count: 'exact' }),
            supabase.from('action_plans').select('status', { count: 'exact' }),
            supabase.from('action_plans').select('request_id').eq('status', 'active')
        ]);
        
        // Actualizar métricas en el DOM
        updateMetricCard('activeAgents', agentsResult.count || 0);
        
        const completedPlans = plansResult.data?.filter(p => p.status === 'completed').length || 0;
        updateMetricCard('completedPlans', completedPlans);
        
        const inProgressPlans = plansResult.data?.filter(p => p.status === 'in_progress').length || 0;
        updateMetricCard('inProgressPlans', inProgressPlans);
        
        const activeProjects = new Set(projectsResult.data?.map(p => p.request_id)).size || 0;
        updateMetricCard('activeProjects', activeProjects);
        
    } catch (error) {
        console.error('Error loading metrics:', error);
        // Mostrar datos de ejemplo en caso de error
        updateMetricCard('activeAgents', 12);
        updateMetricCard('completedPlans', 847);
        updateMetricCard('inProgressPlans', 23);
        updateMetricCard('activeProjects', 8);
    }
}

// Cargar proyectos activos
async function loadProjects() {
    try {
        const { data, error } = await supabase
            .from('action_plans')
            .select('*')
            .eq('status', 'active')
            .order('created_at', { ascending: false })
            .limit(10);
            
        if (error) throw error;
        
        const projectsList = document.getElementById('projectsList');
        if (projectsList && data) {
            projectsList.innerHTML = data.map(project => `
                <div class="real-time-item animate-slide-up">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900">${Utils.truncate(project.initial_request, 40)}</h4>
                            <p class="text-sm text-gray-600">${DOMAIN_MAPPING[project.domain] || project.domain}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="badge badge-success">${Utils.capitalize(project.status)}</span>
                            <span class="text-xs text-gray-500">${Utils.formatRelativeTime(project.created_at)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
    } catch (error) {
        console.error('Error loading projects:', error);
        showTestProjects();
    }
}

// Cargar planes de acción recientes
async function loadActionPlans() {
    try {
        const { data, error } = await supabase
            .from('action_plans')
            .select('*')
            .order('created_at', { ascending: false })
            .limit(10);
            
        if (error) throw error;
        
        const actionPlansList = document.getElementById('actionPlansList');
        if (actionPlansList && data) {
            actionPlansList.innerHTML = data.map(plan => `
                <div class="real-time-item animate-slide-up">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900">${Utils.truncate(plan.initial_request, 40)}</h4>
                            <p class="text-sm text-gray-600">Prioridad: ${plan.priority}</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="badge ${getStatusBadgeClass(plan.status)}">${Utils.capitalize(plan.status)}</span>
                            <span class="text-xs text-gray-500">${Utils.formatRelativeTime(plan.created_at)}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
    } catch (error) {
        console.error('Error loading action plans:', error);
        showTestActionPlans();
    }
}

// Cargar actividad por dominio
async function loadDomainActivity() {
    try {
        const { data, error } = await supabase
            .from('action_plans')
            .select('domain, status')
            .order('created_at', { ascending: false });
            
        if (error) throw error;
        
        // Agrupar por dominio
        const domainStats = {};
        if (data) {
            data.forEach(plan => {
                if (!domainStats[plan.domain]) {
                    domainStats[plan.domain] = { total: 0, completed: 0, in_progress: 0 };
                }
                domainStats[plan.domain].total++;
                if (plan.status === 'completed') domainStats[plan.domain].completed++;
                if (plan.status === 'in_progress') domainStats[plan.domain].in_progress++;
            });
        }
        
        const domainActivity = document.getElementById('domainActivity');
        if (domainActivity) {
            domainActivity.innerHTML = Object.entries(domainStats).map(([domain, stats]) => `
                <div class="domain-card animate-scale-in">
                    <div class="domain-name">${DOMAIN_MAPPING[domain] || domain}</div>
                    <div class="domain-stats">
                        <div class="stat-item">
                            <span class="stat-label">Total</span>
                            <span class="stat-value">${stats.total}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Completados</span>
                            <span class="stat-value">${stats.completed}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">En Progreso</span>
                            <span class="stat-value">${stats.in_progress}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
    } catch (error) {
        console.error('Error loading domain activity:', error);
        showTestDomainActivity();
    }
}

// Cargar tareas en tiempo real
async function loadRealTimeTasks() {
    try {
        const { data, error } = await supabase
            .from('action_plans')
            .select('*')
            .eq('status', 'in_progress')
            .order('created_at', { ascending: false })
            .limit(5);
            
        if (error) throw error;
        
        const realTimeTasks = document.getElementById('realTimeTasks');
        if (realTimeTasks && data) {
            realTimeTasks.innerHTML = data.map(task => `
                <div class="real-time-item animate-slide-left">
                    <div class="status-indicator active"></div>
                    <div class="flex-1">
                        <h4 class="font-medium text-gray-900">${Utils.truncate(task.initial_request, 30)}</h4>
                        <p class="text-xs text-gray-500">${DOMAIN_MAPPING[task.domain] || task.domain} • ${Utils.formatRelativeTime(task.created_at)}</p>
                    </div>
                </div>
            `).join('');
        }
        
    } catch (error) {
        console.error('Error loading real-time tasks:', error);
        showTestRealTimeTasks();
    }
}

// Cargar top agentes
async function loadTopAgents() {
    try {
        const { data, error } = await supabase
            .from('action_plans')
            .select('domain, status')
            .eq('status', 'completed');
            
        if (error) throw error;
        
        // Contar completados por dominio (simulando agentes)
        const agentStats = {};
        if (data) {
            data.forEach(plan => {
                agentStats[plan.domain] = (agentStats[plan.domain] || 0) + 1;
            });
        }
        
        const topAgents = document.getElementById('topAgents');
        if (topAgents) {
            const sortedAgents = Object.entries(agentStats)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5);
                
            topAgents.innerHTML = sortedAgents.map(([domain, count], index) => `
                <div class="real-time-item animate-slide-left" style="animation-delay: ${index * 0.1}s">
                    <div class="flex items-center space-x-3">
                        <div class="text-cyan-500 font-bold">#${index + 1}</div>
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900">${DOMAIN_MAPPING[domain] || domain}</h4>
                            <p class="text-xs text-gray-500">${count} tareas completadas</p>
                        </div>
                        <div class="text-cyan-500">
                            <i class="fas fa-trophy"></i>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
    } catch (error) {
        console.error('Error loading top agents:', error);
        showTestTopAgents();
    }
}

// Cargar alertas del sistema
async function loadSystemAlerts() {
    try {
        // Aquí puedes implementar lógica para detectar alertas
        // Por ahora mostraremos algunas alertas de ejemplo
        showTestAlerts();
        
    } catch (error) {
        console.error('Error loading system alerts:', error);
        showTestAlerts();
    }
}

// Cargar logs del sistema
async function loadSystemLogs() {
    try {
        const { data, error } = await supabase
            .from('action_plans')
            .select('*')
            .order('created_at', { ascending: false })
            .limit(20);
            
        if (error) throw error;
        
        const systemLogs = document.getElementById('systemLogs');
        if (systemLogs && data) {
            systemLogs.innerHTML = data.map(log => `
                <div class="log-entry animate-slide-up">
                    <span class="log-timestamp">${Utils.formatDate(log.created_at)}</span>
                    <span class="log-level info">
                        <i class="${LOG_LEVELS.info.icon}"></i>
                        INFO
                    </span>
                    <span class="log-message">
                        Nuevo plan creado: ${Utils.truncate(log.initial_request, 50)}
                    </span>
                </div>
            `).join('');
        }
        
    } catch (error) {
        console.error('Error loading system logs:', error);
        showTestLogs();
    }
}

// Funciones de utilidad del dashboard
function updateMetricCard(cardId, value) {
    const element = document.getElementById(cardId);
    if (element) {
        element.textContent = value.toLocaleString();
        element.parentElement.parentElement.classList.add('animate-scale-in');
    }
}

function getStatusBadgeClass(status) {
    const classes = {
        'completed': 'badge-success',
        'in_progress': 'badge-warning',
        'pending': 'badge-secondary',
        'cancelled': 'badge-danger',
        'on_hold': 'badge-info'
    };
    return classes[status] || 'badge-secondary';
}

function updateLastUpdateTime() {
    const now = new Date();
    DASHBOARD_CONFIG.state.lastUpdate = now;
    
    const lastUpdateElement = document.getElementById('lastUpdate');
    if (lastUpdateElement) {
        lastUpdateElement.textContent = now.toLocaleTimeString('es-ES');
    }
}

function setLoadingState(isLoading) {
    DASHBOARD_CONFIG.state.isLoading = isLoading;
    
    const refreshButton = document.querySelector('[onclick="refreshDashboard()"]');
    if (refreshButton) {
        if (isLoading) {
            refreshButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Actualizando...';
            refreshButton.disabled = true;
        } else {
            refreshButton.innerHTML = '<i class="fas fa-sync-alt"></i> Actualizar';
            refreshButton.disabled = false;
        }
    }
}

// Configurar auto-refresh
function setupAutoRefresh() {
    if (DASHBOARD_CONFIG.intervals.autoRefresh) {
        clearInterval(DASHBOARD_CONFIG.intervals.autoRefresh);
    }
    
    if (DASHBOARD_CONFIG.state.isAutoRefreshEnabled) {
        DASHBOARD_CONFIG.intervals.autoRefresh = setInterval(() => {
            refreshDashboard();
        }, DASHBOARD_CONFIG.autoRefreshInterval);
    }
}

// Configurar actualizaciones en tiempo real
function setupRealTimeUpdates() {
    // Configurar suscripción a cambios en tiempo real
    if (supabase) {
        const subscription = supabase
            .channel('dashboard_updates')
            .on('postgres_changes', 
                { event: '*', schema: 'public', table: 'action_plans' },
                (payload) => {
                    console.log('Real-time update:', payload);
                    loadRealTimeTasks();
                    loadMetrics();
                }
            )
            .subscribe();
    }
}

// Función principal de refresh (llamada desde HTML)
async function refreshDashboard() {
    try {
        await loadDashboardData();
        updateCharts();
        showNotification('Dashboard actualizado', 'success');
    } catch (error) {
        console.error('Error refreshing dashboard:', error);
        showNotification('Error actualizando dashboard', 'error');
    }
}

/* ===== CHARTS - Sistema de Gráficos y Visualizaciones ===== */

// Inicializar gráficos
function initializeCharts() {
    createAgentPerformanceChart();
    createPlanStatusChart();
}

// Gráfico de rendimiento de agentes
function createAgentPerformanceChart() {
    const ctx = document.getElementById('agentPerformanceChart');
    if (!ctx) return;
    
    // Destruir gráfico existente si existe
    if (DASHBOARD_CONFIG.charts.agentPerformance) {
        DASHBOARD_CONFIG.charts.agentPerformance.destroy();
    }
    
    DASHBOARD_CONFIG.charts.agentPerformance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
            datasets: [
                {
                    label: 'Capa 1 - Orquestación',
                    data: [65, 78, 82, 75, 88, 92, 85],
                    borderColor: CHART_COLORS.agentLayers.layer_1,
                    backgroundColor: CHART_COLORS.agentLayers.layer_1 + '20',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 6,
                    pointHoverRadius: 8
                },
                {
                    label: 'Capa 2 - Especialización',
                    data: [55, 68, 75, 70, 82, 88, 78],
                    borderColor: CHART_COLORS.agentLayers.layer_2,
                    backgroundColor: CHART_COLORS.agentLayers.layer_2 + '20',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 6,
                    pointHoverRadius: 8
                },
                {
                    label: 'Capa 3 - Ejecución',
                    data: [72, 85, 78, 90, 95, 88, 93],
                    borderColor: CHART_COLORS.agentLayers.layer_3,
                    backgroundColor: CHART_COLORS.agentLayers.layer_3 + '20',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        padding: 20,
                        usePointStyle: true,
                        font: {
                            size: 12,
                            weight: '500'
                        }
                    }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    titleColor: '#1e293b',
                    bodyColor: '#64748b',
                    borderColor: '#e2e8f0',
                    borderWidth: 1,
                    cornerRadius: 8,
                    padding: 12
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        font: {
                            size: 11
                        },
                        color: '#64748b'
                    }
                },
                y: {
                    beginAtZero: true,
                    max: 100,
                    grid: {
                        color: '#f1f5f9'
                    },
                    ticks: {
                        font: {
                            size: 11
                        },
                        color: '#64748b',
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            },
            elements: {
                point: {
                    hoverBackgroundColor: '#ffffff',
                    hoverBorderWidth: 3
                }
            },
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            }
        }
    });
}

// Gráfico de estado de planes
function createPlanStatusChart() {
    const ctx = document.getElementById('planStatusChart');
    if (!ctx) return;
    
    // Destruir gráfico existente si existe
    if (DASHBOARD_CONFIG.charts.planStatus) {
        DASHBOARD_CONFIG.charts.planStatus.destroy();
    }
    
    const data = {
        labels: ['Completados', 'En Progreso', 'Pendientes', 'En Pausa', 'Cancelados'],
        datasets: [{
            data: [45, 23, 15, 12, 5],
            backgroundColor: [
                CHART_COLORS.planStatus.completed,
                CHART_COLORS.planStatus.in_progress,
                CHART_COLORS.planStatus.pending,
                CHART_COLORS.planStatus.on_hold,
                CHART_COLORS.planStatus.cancelled
            ],
            borderWidth: 3,
            borderColor: '#ffffff',
            hoverBorderWidth: 4,
            hoverOffset: 8
        }]
    };
    
    DASHBOARD_CONFIG.charts.planStatus = new Chart(ctx, {
        type: 'doughnut',
        data: data,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '60%',
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    backgroundColor: 'rgba(255, 255, 255, 0.95)',
                    titleColor: '#1e293b',
                    bodyColor: '#64748b',
                    borderColor: '#e2e8f0',
                    borderWidth: 1,
                    cornerRadius: 8,
                    padding: 12,
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.parsed;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                }
            },
            animation: {
                animateRotate: true,
                duration: 1500,
                easing: 'easeOutQuart'
            }
        }
    });
    
    // Crear leyenda personalizada
    createPlanChartLegend(data);
}

// Crear leyenda personalizada para el gráfico de planes
function createPlanChartLegend(data) {
    const legendContainer = document.getElementById('planChartLegend');
    if (!legendContainer) return;
    
    const legendHTML = data.labels.map((label, index) => {
        const color = data.datasets[0].backgroundColor[index];
        const value = data.datasets[0].data[index];
        return `
            <div class="legend-item">
                <div class="legend-color" style="background-color: ${color}"></div>
                <span class="legend-label">${label}</span>
                <span class="legend-value">${value}</span>
            </div>
        `;
    }).join('');
    
    legendContainer.innerHTML = legendHTML;
}

// Actualizar datos de gráficos desde la base de datos
async function updateCharts() {
    try {
        // Actualizar gráfico de rendimiento de agentes
        await updateAgentPerformanceChart();
        
        // Actualizar gráfico de estado de planes
        await updatePlanStatusChart();
        
    } catch (error) {
        console.error('Error updating charts:', error);
    }
}

// Actualizar gráfico de rendimiento de agentes con datos reales
async function updateAgentPerformanceChart() {
    if (!DASHBOARD_CONFIG.charts.agentPerformance || !supabase) return;
    
    try {
        // Obtener datos de rendimiento por día de la semana
        const { data, error } = await supabase
            .from('action_plans')
            .select('created_at, status, domain')
            .gte('created_at', new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString());
            
        if (error) throw error;
        
        // Procesar datos por día de la semana y dominio
        const weekData = processWeeklyData(data);
        
        // Actualizar gráfico
        DASHBOARD_CONFIG.charts.agentPerformance.data.datasets.forEach((dataset, index) => {
            dataset.data = weekData[index] || [0, 0, 0, 0, 0, 0, 0];
        });
        
        DASHBOARD_CONFIG.charts.agentPerformance.update('none');
        
    } catch (error) {
        console.error('Error updating agent performance chart:', error);
    }
}

// Actualizar gráfico de estado de planes con datos reales
async function updatePlanStatusChart() {
    if (!DASHBOARD_CONFIG.charts.planStatus || !supabase) return;
    
    try {
        const { data, error } = await supabase
            .from('action_plans')
            .select('status');
            
        if (error) throw error;
        
        // Contar estados
        const statusCounts = {
            completed: 0,
            in_progress: 0,
            pending: 0,
            on_hold: 0,
            cancelled: 0
        };
        
        data?.forEach(plan => {
            if (statusCounts.hasOwnProperty(plan.status)) {
                statusCounts[plan.status]++;
            }
        });
        
        const chartData = [
            statusCounts.completed,
            statusCounts.in_progress,
            statusCounts.pending,
            statusCounts.on_hold,
            statusCounts.cancelled
        ];
        
        // Actualizar gráfico
        DASHBOARD_CONFIG.charts.planStatus.data.datasets[0].data = chartData;
        DASHBOARD_CONFIG.charts.planStatus.update('none');
        
        // Actualizar leyenda
        const updatedData = {
            labels: DASHBOARD_CONFIG.charts.planStatus.data.labels,
            datasets: [{
                data: chartData,
                backgroundColor: DASHBOARD_CONFIG.charts.planStatus.data.datasets[0].backgroundColor
            }]
        };
        createPlanChartLegend(updatedData);
        
    } catch (error) {
        console.error('Error updating plan status chart:', error);
    }
}

// Procesar datos semanales para el gráfico de rendimiento
function processWeeklyData(data) {
    const weekdays = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
    const domains = ['PER', 'ACC', 'ACN_FDX'];
    
    const result = domains.map(() => new Array(7).fill(0));
    
    if (!data) return result;
    
    data.forEach(plan => {
        const date = new Date(plan.created_at);
        const dayIndex = (date.getDay() + 6) % 7; // Convertir domingo=0 a lunes=0
        const domainIndex = domains.indexOf(plan.domain);
        
        if (domainIndex !== -1 && plan.status === 'completed') {
            result[domainIndex][dayIndex]++;
        }
    });
    
    // Convertir a porcentajes (simulado)
    return result.map(domainData => 
        domainData.map(count => Math.min(100, count * 10 + Math.random() * 20))
    );
}

// Alternar vista de gráficos
function toggleChartView(chartType) {
    const buttons = document.querySelectorAll('[data-chart]');
    buttons.forEach(btn => btn.classList.remove('active'));
    
    const activeButton = document.querySelector(`[data-chart="${chartType}"]`);
    if (activeButton) {
        activeButton.classList.add('active');
    }
    
    // Lógica para cambiar vista del gráfico
    if (chartType === 'performance') {
        // Cambiar a vista de performance
        updateAgentPerformanceChart();
    } else if (chartType === 'agents') {
        // Cambiar a vista de agentes
        updateAgentPerformanceChart();
    }
}

// Exportar funciones para uso global
window.initializeCharts = initializeCharts;
window.updateCharts = updateCharts;
window.toggleChartView = toggleChartView;

// Inicializar gráficos cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
    // Esperar un poco para asegurar que Chart.js esté cargado
    setTimeout(() => {
        if (typeof Chart !== 'undefined') {
            initializeCharts();
        } else {
            console.error('Chart.js not loaded');
        }
    }, 1000);
});

// Inicialización segura - agregar al final
document.addEventListener('DOMContentLoaded', function() {
    // Esperar a que todas las librerías estén cargadas
    setTimeout(() => {
        try {
            if (typeof initializeDashboard === 'function') {
                initializeDashboard();
            } else {
                console.log('Dashboard en modo demo');
                showTestData();
            }
        } catch (error) {
            console.error('Error en inicialización:', error);
            showTestData();
        }
    }, 1500);
});
                
    </script>
</body>
</html>
